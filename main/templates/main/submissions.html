{% extends 'main/base.html' %}

{% block title %}Pending Submissions - BlogDCR{% endblock %}

{% block content %}
<div class="container">
    <section class="content-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div>
                <h1>Pending Submissions</h1>
                <div style="margin-top: 0.5rem;">
                    <span style="
                        background-color: #e8f5e8;
                        color: var(--primary-green);
                        padding: 0.25rem 0.75rem;
                        border-radius: var(--border-radius-button);
                        font-size: 0.875rem;
                        font-weight: 600;
                    ">{{ submissions.count }} Pending Review</span>
                </div>
            </div>
            <a href="{% url 'main:dashboard' %}" style="color: var(--gray-dark); text-decoration: none;">← Back to Dashboard</a>
        </div>
        
        <!-- Submissions List -->
        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
            {% for submission in submissions %}
            <div class="card" style="border-left: 4px solid var(--primary-green);">
                <div style="display: flex; justify-content: space-between; align-items: start; gap: 2rem;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <span class="status-badge" style="
                                background-color: var(--primary-green);
                                color: var(--white);
                            ">{{ submission.content_type|upper }}</span>
                            <span style="color: var(--gray-dark); font-size: 0.875rem;">
                                Submitted {{ submission.created_at|timesince }} ago
                            </span>
                        </div>
                        
                        <h3 style="margin-bottom: 0.75rem;">{{ submission.title }}</h3>
                        
                        <p style="color: var(--gray-dark); margin-bottom: 1rem;">
                            {{ submission.description|truncatewords:30 }}
                        </p>
                        
                        <div style="font-size: 0.875rem; color: var(--gray-dark);">
                            <strong>By:</strong> {{ submission.author_name }}
                            {% if submission.author_class_year %} '{{ submission.author_class_year }}{% endif %}
                            • <strong>Platform:</strong> {{ submission.platform|default:"N/A" }}
                            {% if submission.content_type == "playlist" and submission.playlist_url %}

                            {% endif %}
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; min-width: 120px;">
                        <button 
                            onclick="approveSubmission({{ submission.id }})"
                            class="btn-primary"
                            style="font-size: 0.875rem; padding: 0.5rem 1rem;"
                        >
                            Approve
                        </button>
                        
                        <button 
                            onclick="previewSubmission({{ submission.id }})"
                            style="
                                background-color: var(--white);
                                color: var(--gray-dark);
                                border: 1px solid var(--gray-medium);
                                padding: 0.5rem 1rem;
                                border-radius: var(--border-radius-button);
                                font-size: 0.875rem;
                                cursor: pointer;
                            "
                        >
                            Preview
                        </button>
                        
                        <button 
                            onclick="rejectSubmission({{ submission.id }})"
                            style="
                                background-color: var(--status-private);
                                color: var(--white);
                                border: none;
                                padding: 0.5rem 1rem;
                                border-radius: var(--border-radius-button);
                                font-size: 0.875rem;
                                cursor: pointer;
                            "
                        >
                            Reject
                        </button>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="card" style="text-align: center; padding: 3rem;">
                <h3 style="color: var(--gray-dark); margin-bottom: 1rem;">No Pending Submissions</h3>
                <p style="color: var(--gray-dark);">All submissions have been reviewed. New submissions will appear here for approval.</p>
            </div>
            {% endfor %}
        </div>
    </section>
</div>

<script>
function approveSubmission(submissionId) {
    if (confirm('Approve this submission and publish it to the site?')) {
        fetch(`/api/approve/${submissionId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error approving submission');
            }
        });
    }
}

function rejectSubmission(submissionId) {
    if (confirm('Reject this submission? This action cannot be undone.')) {
        fetch(`/api/reject/${submissionId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error rejecting submission');
            }
        });
    }
}

function previewSubmission(submissionId) {
    window.open(`/preview/${submissionId}/`, '_blank');
}
</script>

{% csrf_token %}
{% endblock %}
