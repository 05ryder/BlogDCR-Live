{% extends 'main/base.html' %}

{% block title %}Preview: {{ submission.title }} - BlogDCR{% endblock %}

{% block content %}
<div class="container">
    <section class="content-section">
        <!-- Preview Header -->
        <div style="
            background-color: var(--status-archived);
            color: var(--white);
            padding: 1rem 2rem;
            margin: -2rem -2rem 2rem -2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        ">
            <div>
                <h2 style="margin: 0; color: var(--white);">PREVIEW MODE</h2>
                <p style="margin: 0; opacity: 0.9;">This is how the submission will appear when published</p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button onclick="window.close()" style="
                    background-color: var(--white);
                    color: var(--status-archived);
                    border: none;
                    padding: 0.5rem 1rem;
                    border-radius: var(--border-radius-button);
                    font-weight: 600;
                    cursor: pointer;
                ">Close Preview</button>
            </div>
        </div>

        <!-- Content Preview -->
        <div class="card">
            <div style="margin-bottom: 1.5rem;">
                <span class="status-badge" style="
                    background-color: var(--primary-green);
                    color: var(--white);
                ">{{ submission.content_type|upper }}</span>
            </div>
            
            <h1 style="margin-bottom: 1rem;">{{ submission.title }}</h1>
            
            <div style="
                color: var(--gray-dark);
                font-size: 0.875rem;
                margin-bottom: 2rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid var(--gray-medium);
            ">
                <strong>By:</strong> {{ submission.author_name }}
                {% if submission.author_class_year %} '{{ submission.author_class_year }}{% endif %}
                • <strong>Email:</strong> {{ submission.author_email }}
                {% if submission.platform %}
                • <strong>Platform:</strong> {{ submission.platform }}
                {% endif %}
                <br>
                <strong>Submitted:</strong> {{ submission.created_at|date:"F d, Y \a\t g:i A" }}
            </div>
            
            {% if submission.description %}
            <div style="margin-bottom: 2rem;">
                <h3>Description</h3>
                <p style="white-space: pre-wrap;">{{ submission.description }}</p>
            </div>
            {% endif %}
            
            {% if submission.content_text %}
            <div style="margin-bottom: 2rem;">
                <h3>Content</h3>
                <div style="white-space: pre-wrap; line-height: 1.6;">{{ submission.content_text }}</div>
            </div>
            {% endif %}
            
            {% if submission.playlist_url %}
            <div style="margin-bottom: 2rem;">
                <h3>Playlist Link</h3>
                <a href="{{ submission.playlist_url }}" target="_blank" style="
                    color: var(--primary-green);
                    text-decoration: none;
                    font-weight: 600;
                ">{{ submission.playlist_url }}</a>
            </div>
            {% endif %}
            
            {% if submission.media_file %}
            <div style="margin-bottom: 2rem;">
                <h3>Media File</h3>
                <div style="
                    background-color: var(--gray-light);
                    padding: 2rem;
                    border-radius: var(--border-radius-card);
                    text-align: center;
                    border: 1px solid var(--gray-medium);
                ">
                    <p style="color: var(--gray-dark); margin-bottom: 1rem;">Media Preview</p>
                    <p style="font-size: 0.875rem; color: var(--gray-dark);">
                        File: {{ submission.media_file.name }}
                    </p>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Action Buttons -->
        <div style="
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 1000;
        ">
            <button onclick="approveFromPreview()" style="
                background-color: var(--status-active);
                color: var(--white);
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: var(--border-radius-button);
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            ">Approve & Publish</button>
            
            <button onclick="rejectFromPreview()" style="
                background-color: var(--status-private);
                color: var(--white);
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: var(--border-radius-button);
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            ">Reject</button>
        </div>
    </section>
</div>

<script>
function approveFromPreview() {
    if (confirm('Approve this submission and publish it to the site?')) {
        fetch(`/api/approve/{{ submission.id }}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Submission approved and published!');
                window.close();
            } else {
                alert('Error approving submission');
            }
        });
    }
}

function rejectFromPreview() {
    if (confirm('Reject this submission? This action cannot be undone.')) {
        fetch(`/api/reject/{{ submission.id }}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Submission rejected.');
                window.close();
            } else {
                alert('Error rejecting submission');
            }
        });
    }
}
</script>
{% endblock %}
